const express = require('express');\nconst logger = require('./logger');\n\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\napp.use((req, res, next) => {\n  logger.info('Incoming request', {\n    method: req.method,\n    url: req.url,\n    ip: req.ip\n  });\n  next();\n});\n\napp.get('/', (req, res) => {\n  logger.info('Root endpoint accessed');\n  res.json({ message: 'Server is running', timestamp: new Date().toISOString() });\n});\n\napp.get('/health', (req, res) => {\n  logger.info('Health check endpoint accessed');\n  res.json({ status: 'healthy', timestamp: new Date().toISOString() });\n});\n\napp.post('/log', (req, res) => {\n  logger.info('Log endpoint called', { body: req.body });\n  res.json({ message: 'Log received', data: req.body });\n});\n\napp.post('/process', (req, res, next) => {\n  try {\n    const { userId, action } = req.body;\n    \n    if (!userId || !action) {\n      const error = new Error('Missing required fields: userId and action are required');\n      logger.error('Validation error in /process endpoint', {\n        error: error.message,\n        receivedData: { userId, action },\n        url: req.url,\n        method: req.method\n      });\n      return res.status(400).json({ error: 'Bad Request', message: 'Missing required fields: userId and action are required' });\n    }\n    \n    if (typeof userId !== 'string' || userId.trim().length === 0) {\n      const error = new Error('Invalid userId: must be a non-empty string');\n      logger.error('Validation error in /process endpoint', {\n        error: error.message,\n        receivedData: { userId, action },\n        url: req.url,\n        method: req.method\n      });\n      return res.status(400).json({ error: 'Bad Request', message: 'Invalid userId: must be a non-empty string' });\n    }\n    \n    logger.info('Processing request', { userId, action });\n    res.json({ message: 'Processing completed', userId, action });\n  } catch (err) {\n    logger.error('Unexpected error in /process endpoint', {\n      error: err.message,\n      stack: err.stack,\n      url: req.url,\n      method: req.method\n    });\n    next(err);\n  }\n});\n\napp.post('/calculate', (req, res, next) => {\n  try {\n    const data = req.body;\n    \n    logger.info('Calculate endpoint called', { receivedData: data });\n    \n    const user = data.user;\n    const items = data.items;\n    \n    if (!items || items.length === 0) {\n      const error = new Error('Invalid input: items array cannot be empty.');\n      logger.error('Validation error in /calculate endpoint', {\n        error: error.message,\n        receivedData: data,\n        url: req.url,\n        method: req.method\n      });\n      return res.status(400).json({ error: 'Bad Request', message: 'The items array must not be empty.' });\n    }\n\n    const firstItem = items[0].value;\n    const lastItem = items[items.length - 1].value;\n\n    if (typeof firstItem !== 'number' || typeof lastItem !== 'number') {\n      const error = new Error('Invalid input: firstItem and lastItem must be numbers.');\n      logger.error('Validation error in /calculate endpoint', {\n        error: error.message,\n        receivedData: data,\n        url: req.url,\n        method: req.method\n      });\n      return res.status(400).json({ error: 'Bad Request', message: 'firstItem and lastItem must be numeric values.' });\n    }\n\n    const userName = user.name.toUpperCase();\n    const totalItems = items.length;\n    \n    const result = {\n      userName,\n      totalItems,\n      firstItem,\n      lastItem,\n      sum: firstItem + lastItem\n    };\n    \n    res.json({ message: 'Calculation completed', result });\n  } catch (err) {\n    logger.error('Unexpected error in /calculate endpoint', {\n      error: err.message,\n      stack: err.stack,\n      url: req.url,\n      method: req.method\n    });\n    next(err);\n  }\n});\n\napp.get('/error', (req, res, next) => {\n  logger.error('Error endpoint accessed - generating test error');\n  const error = new Error('Test error for logging');\n  next(error);\n});\n\napp.use((err, req, res, next) => {\n  logger.error('Error occurred', {\n    error: err.message,\n    stack: err.stack,\n    url: req.url,\n    method: req.method\n  });\n  res.status(500).json({ error: 'Internal server error', message: err.message });\n});\n\napp.listen(PORT, () => {\n  logger.info(`Server started on port ${PORT}`);\n  console.log(`Server is running on http://localhost:${PORT}`);\n});\n\n